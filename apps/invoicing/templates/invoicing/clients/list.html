{% extends "invoicing/base_app.html" %}
{% load invoicing_tags %}

{% block title %}Clientes · Freelance{% endblock %}

{% block app_content %}
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-semibold text-slate-900 dark:text-slate-100">Clientes</h1>
    <div class="flex gap-2">
      <a href="{% url 'invoicing:export_clients_csv' %}"
         class="rounded-lg border border-slate-300 dark:border-slate-600 px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
        Exportar CSV
      </a>
      {% has_role request.user business "owner" "editor" as can_edit %}
      {% if can_edit %}
        <a href="{% url 'invoicing:client_create' %}"
           class="rounded-lg bg-slate-900 dark:bg-slate-100 px-4 py-2 text-sm font-medium text-white dark:text-slate-900 hover:bg-slate-700 dark:hover:bg-slate-300 transition-colors">
          Nuevo cliente
        </a>
      {% endif %}
    </div>
  </div>

  <form method="get" class="mb-4">
    <input type="text" name="q" value="{{ q }}" placeholder="Buscar por nombre..."
           class="w-full max-w-sm rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400">
  </form>

  {% if clients %}
    <div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 overflow-hidden">
      <table class="w-full text-sm">
        <thead class="bg-slate-50 dark:bg-slate-700/50 text-left text-xs font-medium text-slate-500 dark:text-slate-400 uppercase tracking-wider">
          <tr>
            <th class="px-4 py-3">Nombre</th>
            <th class="px-4 py-3">NIF/CIF</th>
            <th class="px-4 py-3 hidden sm:table-cell">Email</th>
            <th class="px-4 py-3 hidden md:table-cell">Ciudad</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-200 dark:divide-slate-700">
          {% for client in clients %}
            <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/30">
              <td class="px-4 py-3 font-medium text-slate-900 dark:text-slate-100">{{ client.name }}</td>
              <td class="px-4 py-3 text-slate-600 dark:text-slate-400">{{ client.tax_id|default:"—" }}</td>
              <td class="px-4 py-3 text-slate-600 dark:text-slate-400 hidden sm:table-cell">{{ client.email|default:"—" }}</td>
              <td class="px-4 py-3 text-slate-600 dark:text-slate-400 hidden md:table-cell">{{ client.city|default:"—" }}</td>
              <td class="px-4 py-3 text-right">
                {% if can_edit %}
                  <a href="{% url 'invoicing:client_edit' client.pk %}" class="text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-slate-100">Editar</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="rounded-xl border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 p-8 text-center text-slate-500 dark:text-slate-400">
      <p>No hay clientes{% if q %} que coincidan con "{{ q }}"{% endif %}.</p>
    </div>
  {% endif %}
{% endblock %}
